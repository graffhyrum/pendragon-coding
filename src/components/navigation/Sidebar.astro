---
interface Props {
	sections: Array<{
		title: string;
		content: Array<{
			title: string;
			link: Array<{ title?: string; href: string }>;
		}>;
	}>;
}

const { sections } = Astro.props;

// Generate section ID from title
function getSectionId(title: string): string {
	return title
		.toLowerCase()
		.replace(/[^a-z0-9\s-]/g, '')
		.replace(/\s+/g, '-');
}
---

<aside class="sidebar" aria-label="Section navigation">
    <nav>
        <h3 class="sidebar-title">Sections</h3>
        <ul class="section-list">
			{sections.map((section) => {
				const sectionId = getSectionId(section.title);
				return (
                        <li>
                            <a
                                    href={`#${sectionId}`}
                                    class="section-link"
                                    data-section={sectionId}
                            >
								{section.title}
                            </a>
							{section.content.length > 0 && (
                                    <ul class="content-list">
										{section.content.map((item) => {
											const sectionId = getSectionId(section.title);
											const contentId = `${sectionId}-${getSectionId(item.title)}`;
											return (
                                                    <li>
                                                        <a
                                                                href={`#${contentId}`}
                                                                class="content-link"
                                                                data-content={contentId}
                                                                title={item.title}
                                                        >
															{item.title}
                                                        </a>
                                                    </li>
											);
										})}
                                    </ul>
							)}
                        </li>
				);
			})}
        </ul>
    </nav>

    <!-- Mobile menu button -->
    <button
            class="sidebar-toggle mobile-only"
            aria-label="Toggle sidebar"
            aria-expanded="false"
    >
        <span class="hamburger"></span>
    </button>
</aside>

<style>
	.sidebar {
		width: 16rem;
		position: sticky;
		top: 2rem;
			overflow-y: auto;
		background: rgb(240 253 244);
		border: 1px solid rgb(134 239 172);
		border-radius: 0.5rem;
		padding: 1.5rem;
		margin-right: 2rem;
	}

    .sidebar-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: rgb(20 83 45);
        margin-bottom: 1rem;
        border-bottom: 2px solid rgb(22 163 74);
        padding-bottom: 0.5rem;
    }

    .section-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .content-list {
        list-style: none;
        padding: 0;
        margin: 0.5rem 0 0 1rem;
    }

    .content-link {
        display: block;
        padding: 0.25rem 0.5rem;
        color: rgb(34 197 94);
        text-decoration: none;
        border-radius: 0.25rem;
        transition: all 0.2s ease;
        font-size: 0.875rem;
        border-left: 2px solid transparent;
    }

    .content-link:hover {
        background: rgb(220 252 231);
        color: rgb(21 128 61);
        border-left-color: rgb(34 197 94);
    }

    .content-link:focus {
        outline: 1px solid rgb(34 197 94);
        outline-offset: 1px;
    }

    /* Active content highlighting */
    .content-link[data-active="true"] {
        background: rgb(34 197 94);
        color: white;
        border-left-color: rgb(21 128 61);
    }

    .section-link {
        display: block;
        padding: 0.5rem 0.75rem;
        color: rgb(22 101 52);
        text-decoration: none;
        border-radius: 0.25rem;
        transition: all 0.2s ease;
        border-left: 3px solid transparent;
    }

    .section-link:hover {
        background: rgb(187 247 208);
        color: rgb(20 83 45);
        border-left-color: rgb(22 163 74);
    }

    .section-link:focus {
        outline: 2px solid rgb(22 163 74);
        outline-offset: 2px;
    }

    /* Active section highlighting */
    .section-link[data-active="true"] {
        background: rgb(22 163 74);
        color: white;
        border-left-color: rgb(20 83 45);
    }

    .sidebar-toggle {
        display: none;
        position: fixed;
        top: 1rem;
        left: 1rem;
        z-index: 50;
        background: rgb(22 163 74);
        border: none;
        border-radius: 0.25rem;
        padding: 0.5rem;
        cursor: pointer;
    }

    .hamburger {
        display: block;
        width: 1.5rem;
        height: 2px;
        background: white;
        position: relative;
        transition: all 0.3s ease;
    }

    .hamburger::before,
    .hamburger::after {
        content: '';
        position: absolute;
        width: 1.5rem;
        height: 2px;
        background: white;
        transition: all 0.3s ease;
    }

    .hamburger::before {
        top: -0.5rem;
    }

    .hamburger::after {
        top: 0.5rem;
    }

    /* Mobile responsive */
    @media (max-width: 768px) {
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 20rem;
            max-height: 100vh;
            z-index: 40;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            margin-right: 0;
            border-radius: 0;
            border-left: none;
            border-top: none;
            border-bottom: none;
        }

        .sidebar.open {
            transform: translateX(0);
        }

        .sidebar-toggle {
            display: block;
        }

        .sidebar-toggle[aria-expanded="true"] .hamburger {
            background: transparent;
        }

        .sidebar-toggle[aria-expanded="true"] .hamburger::before {
            top: 0;
            transform: rotate(45deg);
        }

        .sidebar-toggle[aria-expanded="true"] .hamburger::after {
            top: 0;
            transform: rotate(-45deg);
        }
    }

    /* Dark mode */
    @media (prefers-color-scheme: dark) {
        .sidebar {
            background: rgb(6 78 59);
            border-color: rgb(21 128 61);
        }

        .sidebar-title {
            color: rgb(220 252 231);
            border-bottom-color: rgb(74 222 128);
        }

        .section-link {
            color: rgb(187 247 208);
        }

        .section-link:hover {
            background: rgb(5 46 22);
            color: rgb(220 252 231);
            border-left-color: rgb(74 222 128);
        }

        .section-link[data-active="true"] {
            background: rgb(21 128 61);
            color: white;
            border-left-color: rgb(74 222 128);
        }

        .content-link {
            color: rgb(74 222 128);
        }

        .content-link:hover {
            background: rgb(6 78 59);
            color: rgb(134 239 172);
            border-left-color: rgb(74 222 128);
        }

        .content-link[data-active="true"] {
            background: rgb(74 222 128);
            color: rgb(6 78 59);
            border-left-color: rgb(134 239 172);
        }
    }

    /* Custom scrollbar styling */
    .sidebar::-webkit-scrollbar {
        width: 6px;
    }

    .sidebar::-webkit-scrollbar-track {
        background: rgb(220 252 231);
        border-radius: 3px;
    }

    .sidebar::-webkit-scrollbar-thumb {
        background: rgb(134 239 172);
        border-radius: 3px;
    }

    .sidebar::-webkit-scrollbar-thumb:hover {
        background: rgb(22 163 74);
    }

    /* Firefox scrollbar */
    .sidebar {
        scrollbar-width: thin;
        scrollbar-color: rgb(134 239 172) rgb(220 252 231);
    }

    /* Dark mode scrollbar */
    @media (prefers-color-scheme: dark) {
        .sidebar::-webkit-scrollbar-track {
            background: rgb(5 46 22);
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: rgb(74 222 128);
        }

        .sidebar::-webkit-scrollbar-thumb:hover {
            background: rgb(134 239 172);
        }

        .sidebar {
            scrollbar-color: rgb(74 222 128) rgb(5 46 22);
        }
    }

</style>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		const sidebar = document.querySelector('.sidebar');
		const toggle = document.querySelector('.sidebar-toggle');
		const sectionLinks = document.querySelectorAll('.section-link');
		const contentLinks = document.querySelectorAll('.content-link');

		// Mobile menu toggle
		if (toggle && sidebar) {
			toggle.addEventListener('click', () => {
				const isOpen = sidebar.classList.contains('open');
				sidebar.classList.toggle('open');
				toggle.setAttribute('aria-expanded', String(!isOpen));
			});
		}

		// Mouse hover active tracking
		function clearActiveStates() {
			sectionLinks.forEach(link => {
				link.removeAttribute('data-active');
			});
			contentLinks.forEach(link => {
				link.removeAttribute('data-active');
			});
		}

		// Add hover listeners to section links
		sectionLinks.forEach(link => {
			link.addEventListener('mouseenter', () => {
				clearActiveStates();
				link.setAttribute('data-active', 'true');
			});
		});

		// Add hover listeners to content links
		contentLinks.forEach(link => {
			link.addEventListener('mouseenter', () => {
				clearActiveStates();
				link.setAttribute('data-active', 'true');
			});
		});

		// Clear active states when mouse leaves sidebar
		if (sidebar) {
			sidebar.addEventListener('mouseleave', () => {
				clearActiveStates();
			});
		}

		// Smooth scroll for anchor links
		sectionLinks.forEach(link => {
			link.addEventListener('click', (e) => {
				e.preventDefault();
				const sectionId = link.getAttribute('data-section');
				if (sectionId) {
					const section = document.getElementById(sectionId);

					if (section) {
						section.scrollIntoView({
							behavior: 'smooth',
							block: 'start'
						});

						// Close mobile menu after navigation
						if (window.innerWidth <= 768 && sidebar && toggle) {
							sidebar.classList.remove('open');
							toggle.setAttribute('aria-expanded', 'false');
						}
					}
				}
			});
		});

		// Smooth scroll for content links
		contentLinks.forEach(link => {
			link.addEventListener('click', (e) => {
				e.preventDefault();
				const contentId = link.getAttribute('data-content');
				if (contentId) {
					const content = document.getElementById(contentId);

					if (content) {
						content.scrollIntoView({
							behavior: 'smooth',
							block: 'start'
						});

						// Close mobile menu after navigation
						if (window.innerWidth <= 768 && sidebar && toggle) {
							sidebar.classList.remove('open');
							toggle.setAttribute('aria-expanded', 'false');
						}
					}
				}
			});
		});
	});
</script>
